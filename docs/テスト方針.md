# テスト方針

## 概要
このドキュメントでは、`mysql-schema-mcp` のハンドラー機能に対するテスト方針を記述します。
まずは `ListTables` メソッドの正常系テストから開始します。

## 1. `ListTables` メソッド テスト

### 1.1. テスト目的
- `docs/requirements.md` に記載された出力フォーマットに従って、テーブル情報が正しく整形されて返却されることを確認する。
- 単一キー、複合キー（PK, UK, FK）、複数のキー制約（特にUK）を含む様々なテーブル構成に対応できることを確認する。

### 1.2. テスト環境
- Dockerを使用してMySQLテスト環境を構築し、実際のデータベースに対してテストを実行する。

### 1.3. テストケース: 複合キーおよび複数UKを含むテーブル構成

#### 1.3.1. テスト用テーブルスキーマ
以下の3つのテーブルを持つデータベース (`test_db` とする) を用意する。

- **`users` テーブル**
    - コメント: "ユーザー情報"
    - カラム:
        - `id` (INT, PK)
        - `email` (VARCHAR, UK)
        - `username` (VARCHAR, UK)
        - `tenant_id` (INT, UK (複合))
        - `employee_id` (INT, UK (複合))
    - キー制約:
        - PK: `id`
        - UK: `email`
        - UK: `username`
        - UK: `(tenant_id, employee_id)`

- **`products` テーブル**
    - コメント: "商品マスタ"
    - カラム:
        - `product_code` (VARCHAR, PK)
        - `maker_code` (VARCHAR, UK (複合))
        - `internal_code` (VARCHAR, UK (複合))
    - キー制約:
        - PK: `product_code`
        - UK: `(maker_code, internal_code)`

- **`order_items` テーブル**
    - コメント: "注文明細"
    - カラム:
        - `order_id` (INT, PK (複合), FK (単一), UK(複合))
        - `item_seq` (INT, PK (複合))
        - `product_maker` (VARCHAR, FK (複合), UK(複合))
        - `product_internal_code` (VARCHAR, FK (複合), UK(複合))
    - キー制約:
        - PK: `(order_id, item_seq)`
        - FK: `order_id` -> `orders.id`  *(注: `orders` テーブルはテストデータに含めないが、制約としては定義)*
        - FK: `(product_maker, product_internal_code)` -> `products.(maker_code, internal_code)`
        - UK: `(order_id, product_maker, product_internal_code)`

#### 1.3.2. 実行手順
1. テスト用DBに上記のスキーマでテーブルを作成する。
2. `ListTables` ツールを `dbName: "test_db"` で呼び出す。
3. 返却されたテキストが以下の期待される出力と一致することを確認する。

#### 1.3.3. 期待される出力

```
データベース「test_db」のテーブル一覧 (全3件)
フォーマット: テーブル名 - テーブルコメント [PK: 主キー] [UK: 一意キー1; 一意キー2...] [FK: 外部キー -> 参照先テーブル.カラム; ...]
※ 複合キー（複数カラムで構成されるキー）は括弧でグループ化: (col1, col2)
※ 複数の異なるキー制約はセミコロンで区切り: key1; key2

- users - ユーザー情報 [PK: id] [UK: email; username; (tenant_id, employee_id)]
- products - 商品マスタ [PK: product_code] [UK: (maker_code, internal_code)]
- order_items - 注文明細 [PK: (order_id, item_seq)] [UK: (order_id, product_maker, product_internal_code)] [FK: order_id -> orders.id; (product_maker, product_internal_code) -> products.(maker_code, internal_code)]
```

## 2. 今後のテスト項目 (検討中)
- `DescribeTables` メソッドのテスト
- エラーケースのテスト (DB接続エラー、存在しないDB/テーブル指定など)
- 特殊文字を含むテーブル/カラム名/コメントのテスト 
